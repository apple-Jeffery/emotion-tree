<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸŒ™ Jeffery çš„æƒ…ç»ªæ ‘æ´</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg-color: rgba(255, 255, 255, 0.65);
      --text-color: #333;
      --entry-bg: rgba(255,255,255,0.8);
    }
    body.dark {
      --bg-color: rgba(44,44,46,0.7);
      --text-color: #eee;
      --entry-bg: rgba(33,33,33,0.8);
    }
    body {
      margin: 0;
      padding: 0;
      background: url('background-soft.jpg') no-repeat center center fixed;
      background-size: cover;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      color: var(--text-color);
    }
    .container {
      background: var(--bg-color);
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      max-width: 720px;
      width: 90%;
      text-align: center;
      backdrop-filter: blur(10px);
    }
    h1 { font-size: 28px; margin-bottom: 10px; color: #3366cc; }
    p.desc { font-size: 14px; color: #555; }
    .emotion-tags { margin: 15px 0; }
    .emotion-tags button {
  margin: 5px;
  padding: 6px 12px;
  font-size: 16px;
  border: none;
  border-radius: 10px;
  background: rgba(255, 255, 255, 0.6);
  backdrop-filter: blur(4px);
  cursor: pointer;
  color: #333;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  transition: all 0.2s ease;
}
    .feedback { margin-top: 10px; font-size: 14px; color: #888; }
    textarea, input {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border-radius: 10px;
      border: 1px solid #ccc;
      margin: 10px 0;
      box-sizing: border-box;
    }
    button {
      margin-top: 10px;
      margin-right: 8px;
      padding: 10px 20px;
      font-size: 15px;
      border: none;
      border-radius: 8px;
      background-color: #337aff;
      color: white;
      cursor: pointer;
    }
    .entry {
      background: var(--entry-bg);
      margin-top: 15px;
      padding: 10px 20px;
      border-left: 5px solid #ffcf66;
      border-radius: 10px;
      text-align: left;
    }
    .entry time { font-size: 12px; color: #888; display: block; margin-bottom: 5px; }
    .nav {
      position: absolute;
      top: 20px;
      left: 20px;
    }
    .nav a {
      text-decoration: none;
      background: #ffffffaa;
      padding: 8px 14px;
      border-radius: 6px;
      color: #333;
      font-weight: bold;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .search-box input {
      padding: 8px;
      width: 80%;
      max-width: 300px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    .highlight { background: yellow; }
    canvas { margin-top: 20px; max-width: 100%; }
  </style>
</head>
<body>
  <div class="nav">
    <a href="https://apple-jeffery.github.io">â† è¿”å› Jeffery ä¸»ç«™</a>
  </div>
  <div class="container">
    <h1>ğŸŒ™ å¤§å®¶çš„æƒ…ç»ªæ ‘æ´ by Jeffery</h1>
    <p class="desc">å†™ä¸‹æ­¤åˆ»å¿ƒæƒ…ï¼Œä¸ç”¨è§£é‡Šï¼Œæ”¾å¿ƒäº¤ç»™è¿™ä¸ªä¸“å±å¤§å®¶çš„æ ‘æ´å§ ğŸŒ³</p>
    <input id="nickname" placeholder="ä½ çš„å°åã€å¤–å·æˆ–ä»»ä½•æ ‡è¯†ï¼ˆå»ºè®®åŠ ä¸Šæ—¶é—´ç‚¹ï¼Œæ›´æœ‰çºªå¿µæ„Ÿï¼ï¼‰">
    <div class="emotion-tags" id="emotionTags">
      <button onclick="toggleEmotion('ğŸ˜Š')">ğŸ˜Š å¼€å¿ƒ</button>
      <button onclick="toggleEmotion('ğŸ˜¢')">ğŸ˜¢ ä¼¤å¿ƒ</button>
      <button onclick="toggleEmotion('ğŸ˜¡')">ğŸ˜¡ ç”Ÿæ°”</button>
      <button onclick="toggleEmotion('ğŸ˜°')">ğŸ˜° ç„¦è™‘</button>
      <button onclick="toggleEmotion('ğŸ¥±')">ğŸ¥± æ— èŠ</button>
      <button onclick="toggleEmotion('ğŸ˜´')">ğŸ˜´ ç–²æƒ«</button>
      <button onclick="toggleEmotion('ğŸ¤©')">ğŸ¤© å…´å¥‹</button>
      <button onclick="toggleEmotion('ğŸ¤¯')">ğŸ¤¯ è¿·èŒ«</button>
    </div>
    <div class="feedback" id="emotionFeedback">å·²é€‰æƒ…ç»ªï¼šæ— </div>
    <textarea id="feeling" placeholder="ä»Šå¤©ä½ æƒ³è¯´ä»€ä¹ˆï¼Ÿ"></textarea>
    <div class="search-box">
      ğŸ” æœç´¢ç•™è¨€ï¼š<input type="text" id="search" oninput="highlightSearch()">
    </div>
    <button onclick="saveFeeling()">ğŸ’¾ ä¿å­˜</button>
    <button onclick="exportFeelings()">â˜ï¸ å¯¼å‡º</button>
    <button onclick="clearFeelings()">ğŸ—‘ï¸ æ¸…é™¤</button>
    <button onclick="toggleMode()">ğŸŒƒ æ·±æµ…åˆ‡æ¢</button>
    <button onclick="randomFeeling()">â¤ï¸ éšæœºä¸€æ¡</button>
    <canvas id="chart" height="200"></canvas>
    
<footer id="footer-msg" style="margin-top: 40px; font-size: 13px; color: #999; text-align: center;">
  è¿™ä¸ªå°æ ‘æ´æ˜¯ Jeffery æ‚„æ‚„æ­å»ºçš„ï¼Œæ¬¢è¿ä½ éšæ—¶æ¥ä¸¢ä¸‹ä¸€é¢—å¿ƒæƒ…ç³–æœ ğŸ¬
</footer>
<script>
  const messages = [
    "è¿™ä¸ªå°æ ‘æ´æ˜¯ Jeffery æ‚„æ‚„æ­å»ºçš„ï¼Œæ¬¢è¿ä½ éšæ—¶æ¥ä¸¢ä¸‹ä¸€é¢—å¿ƒæƒ…ç³–æœ ğŸ¬",
    "è¿™ä¸ªå°æ ‘æ´æ˜¯ Jeffery å·å·ç§ä¸‹çš„ï¼Œç­‰ä½ æ¥æ‚„æ‚„åŸ‹ä¸‹ç‚¹ä»€ä¹ˆ ğŸŒ±",
    "è¿™ä¸ªå°æ ‘æ´æ˜¯ Jeffery é»˜é»˜å¼€çš„å°å£å­ï¼Œä¸“æ”¶ä½ çš„ç¢ç¢å¿µ âœ¨",
    "è¿™ä¸ªå°æ ‘æ´æ˜¯ Jeffery æ‚„æ‚„å»ºçš„ï¼Œé€‚åˆä¸¢ä¸‹ä¸€å¥æ²¡äººæ‡‚çš„è¯ ğŸŒ™",
    "è¿™ä¸ªå°æ ‘æ´æ˜¯ Jeffery ç•™ä¸‹çš„å°è§’è½ï¼Œæœ‰ç©ºæ¥ååä¹ŸæŒºå¥½ â˜•"
  ];
  const footer = document.getElementById("footer-msg");
  footer.textContent = messages[Math.floor(Math.random() * messages.length)];
</script>
  </div>

  <script>
    (() => {
      window.selectedEmotions = [];
    })();
  </script>
  <script>
    let colors = {};
    const emotionColors = {
      "ğŸ˜Š": "#f6c026",
      "ğŸ˜¢": "#5dade2",
      "ğŸ˜¡": "#e74c3c",
      "ğŸ˜°": "#7f8c8d",
      "ğŸ¥±": "#a29bfe",
      "ğŸ˜´": "#95a5a6",
      "ğŸ¤©": "#f39c12",
      "ğŸ¤¯": "#8e44ad"
    };

    function toggleEmotion(e) {
      const index = selectedEmotions.indexOf(e);
      if (index === -1) {
        selectedEmotions.push(e);
      } else {
        selectedEmotions.splice(index, 1);
      }
      document.getElementById("emotionFeedback").textContent = "å·²é€‰æƒ…ç»ªï¼š" + (selectedEmotions.length ? selectedEmotions.join(' ') : "æ— ");
    }

    function saveFeeling() {
      const text = document.getElementById("feeling").value.trim();
      const nick = document.getElementById("nickname").value.trim();
      if (!text) return;
      const now = new Date();
      const time = `${now.getFullYear()}/${now.getMonth()+1}/${now.getDate()} ${now.toLocaleTimeString()}`;
      const color = colors[nick] || getRandomColor();
      const entry = document.createElement("div");
      entry.className = "entry";
      entry.innerHTML = `<time>${time}</time><strong style="color:${color}">${nick || "åŒ¿å"}</strong>ï¼š<span>${selectedEmotions.join(' ')} ${text}</span>`;
      document.getElementById("log").prepend(entry);
      document.getElementById("feeling").value = "";
      selectedEmotions = [];
      document.getElementById("emotionFeedback").textContent = "å·²é€‰æƒ…ç»ªï¼šæ— ";
      if (nick && !colors[nick]) colors[nick] = color;
      saveToStorage();
      updateChart();
    }

    function updateChart() {
      const ctx = document.getElementById("chart").getContext("2d");
      const data = {};
      document.querySelectorAll(".entry span").forEach(e => {
        [...e.innerText.matchAll(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g)].forEach(m => {
          const emo = m[0];
          data[emo] = (data[emo] || 0) + 1;
        });
      });
      const total = Object.values(data).reduce((a,b) => a + b, 0);
      const labels = Object.keys(data);
      const chartData = labels.map(l => ({
        label: `${l} ${(data[l] / total * 100).toFixed(1)}%`,
        value: data[l],
        backgroundColor: emotionColors[l] || "#ccc"
      }));
      new Chart(ctx, {
        type: "bar",
        data: {
          labels: chartData.map(d => d.label),
          datasets: [{
            data: chartData.map(d => d.value),
            backgroundColor: chartData.map(d => d.backgroundColor)
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { display: false } },
          scales: {
            y: { beginAtZero: true, ticks: { precision: 0 } }
          }
        }
      });
    }

    function getRandomColor() {
      return '#' + Math.floor(Math.random()*16777215).toString(16);
    }

    function exportFeelings() {
      const entries = document.querySelectorAll('.entry');
      let content = '';
      entries.forEach(e => content += e.innerText + '\n\n');
      const blob = new Blob([content], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'jeffery_emotions.txt';
      a.click();
      URL.revokeObjectURL(url);
    }

    function clearFeelings() {
      if (confirm("ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰è®°å½•å—ï¼Ÿ")) {
        document.getElementById("log").innerHTML = "";
        localStorage.removeItem("jeffery-log");
        updateChart();
      }
    }

    function toggleMode() {
      document.body.classList.toggle("dark");
    }

    function highlightSearch() {
      const keyword = document.getElementById("search").value.trim();
      const entries = document.querySelectorAll(".entry span");
      entries.forEach(span => {
        const raw = span.innerText;
        span.innerHTML = keyword ? raw.replace(new RegExp(`(${keyword})`, 'gi'), '<span class="highlight">$1</span>') : raw;
      });
    }

    function randomFeeling() {
      const entries = document.querySelectorAll('.entry');
      if (entries.length === 0) return alert("æš‚æ— ç•™è¨€");
      const randomIndex = Math.floor(Math.random() * entries.length);
      entries[randomIndex].scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    function saveToStorage() {
      localStorage.setItem("jeffery-log", document.getElementById("log").innerHTML);
    }
    function loadFromStorage() {
      const stored = localStorage.getItem("jeffery-log");
      if (stored) document.getElementById("log").innerHTML = stored;
    }

    loadFromStorage();
    updateChart();
  </script>
</body>
</html>
